#!/usr/bin/env python

__doc__ = """
Generates a PDB from an MD-simulation restart files.

Usage: md2pdb <md>
"""

import os
import shutil
import time
import random

from pdbremix import util
from pdbremix import simulate
from pdbremix import force
from pdbremix.lib.docopt import docopt


def relpath(path):
  if path == '':
    return ''
  dirpath, basename = os.path.split(path)
  dirpath = os.path.relpath(dirpath, os.getcwd())
  if dirpath == '' or dirpath == '.':
    return basename
  return os.path.join(dirpath, basename)


if __name__ == "__main__":
  arg = docopt(__doc__)
  md = arg['<md>']
  pdb = md + '.pdb'
  top, crds, vels = simulate.get_restart_files(md)
  top = relpath(top)
  crds = relpath(crds)
  vels = relpath(vels)
  simulate.convert_restart_to_pdb(md, pdb)
  print "restart-files:", top, crds, vels 
  soup = simulate.soup_from_restart_files(top, crds, vels)
  print "elements", ' '.join(set([a.element for a in soup.atoms()]))
  print "generated:", pdb